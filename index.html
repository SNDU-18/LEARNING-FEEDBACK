<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Anonymous Feedback Wall</title>
<style>
  body { font-family: "Segoe UI", sans-serif; margin:0; padding:0; background:#f1f1f1; transition: background 0.4s, color 0.4s; }
  .dark { background:#121212; color:#e4e4e4; }
  #container { max-width:600px; margin:40px auto; padding:20px; }
  #messages { display:flex; flex-direction:column; gap:12px; margin-bottom:70px; }
  .msg { display:flex; align-items:flex-start; padding:10px 14px; border-radius:14px; background:white; box-shadow:0 2px 6px rgba(0,0,0,0.15); }
  .dark .msg { background:#1e1e1e; }
  .avatar { width:40px; height:40px; border-radius:50%; background:#888; margin-right:10px; }
  #inputBox { position:fixed; bottom:0; left:0; right:0; padding:12px; background:white; box-shadow:0 -2px 5px rgba(0,0,0,0.2); }
  .dark #inputBox { background:#1e1e1e; }
  #feedbackInput { width:80%; padding:12px; border-radius:20px; border:none; outline:none; }
  #submitBtn { padding:12px 18px; border:none; border-radius:20px; background:#2a72ff; color:white; cursor:pointer; margin-left:8px; }
  #toggleTheme { position:fixed; top:20px; right:20px; cursor:pointer; padding:10px; border-radius:8px; background:#ddd; }
  .dark #toggleTheme { background:#333; color:white; }
  @keyframes fade { from { opacity:0; transform: translateY(10px);} to { opacity:1; transform:translateY(0);} }
  .fade-in { animation: fade 0.4s ease; }
  @keyframes themeSwitch { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }
  .spin { animation: themeSwitch 0.5s linear; }
</style>
</head>
<body>
<div id="toggleTheme">ðŸŒ“</div>
<div id="container">
  <div id="messages"></div>
</div>
<div id="inputBox">
  <input id="feedbackInput" type="text" placeholder="Enter feedback..." />
  <button id="submitBtn">Submit</button>
</div>

<!-- Firebase -->
<script type="module">
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    /* ------------------ FIREBASE SETUP ------------------ */
    // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyDIL9LBRTE9kcpBsL1sGjC4qdSTh1IbYUk",
    authDomain: "backend-learning-feedback.firebaseapp.com",
    projectId: "backend-learning-feedback",
    storageBucket: "backend-learning-feedback.firebasestorage.app",
    messagingSenderId: "696229938614",
    appId: "1:696229938614:web:63f07549dc86baa90ced17"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const messagesRef = db.ref("messages");


  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const fbRef = ref(db, "feedback");

  const messagesDiv = document.getElementById("messages");
  const input = document.getElementById("feedbackInput");
  const btn = document.getElementById("submitBtn");

  // Auto-delete older than 7 days
  async function autoDelete() {
    const snap = await get(fbRef);
    if (!snap.exists()) return;

    const now = Date.now();
    const week = 7 * 24 * 60 * 60 * 1000;

    snap.forEach(child => {
      if (now - child.val().timestamp > week) {
        remove(ref(db, "feedback/" + child.key));
      }
    });
  }
  autoDelete();

  // Submit
  btn.addEventListener("click", () => {
    const text = input.value.trim();
    if (text === "") return;

    push(fbRef, {
      text: text,
      timestamp: Date.now()
    });

    input.value = "";
  });

  // Display messages
  onValue(fbRef, (snapshot) => {
    messagesDiv.innerHTML = "";
    snapshot.forEach(child => {
      const data = child.val();
      const msg = document.createElement("div");
      msg.className = "msg fade-in";

      msg.innerHTML = `
        <div class="avatar"></div>
        <div>${data.text}</div>
      `;

      messagesDiv.appendChild(msg);
    });
  });

  // Theme toggle
  const toggle = document.getElementById("toggleTheme");
  toggle.addEventListener("click", () => {
    document.body.classList.toggle("dark");
    toggle.classList.add("spin");
    setTimeout(() => toggle.classList.remove("spin"), 600);
  });
</script>
</body>
</html>


